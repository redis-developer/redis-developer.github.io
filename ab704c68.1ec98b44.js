(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{138:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return l}));var r=n(3),a=n(7),o=(n(0),n(168)),s=(n(174),n(175),n(169),n(170),{id:"index-shoppingcart",title:"How to build a Shopping cart app using NodeJS and RedisJSON",sidebar_label:"How to build a Shopping cart app using NodeJS and RedisJSON",slug:"/howtos/shoppingcart"}),i={unversionedId:"howtos/shoppingcart/index-shoppingcart",id:"howtos/shoppingcart/index-shoppingcart",isDocsHomePage:!1,title:"How to build a Shopping cart app using NodeJS and RedisJSON",description:"It\u2019s hard to imagine an online store without a shopping cart. Almost every online store must have the shopping cart functionality to be able to sell products to customers. In order to build a scalable ecommerce platform, you need a powerful framework and a simple storage system. At times, a lot of developers focus on improving the frontend performance of an ecommerce platform to rectify these things. The real bottleneck, however, remains the slow backend load time.",source:"@site/docs/howtos/shoppingcart/index-shoppingcart.mdx",slug:"/howtos/shoppingcart",permalink:"/howtos/shoppingcart",editUrl:"https://github.com/redis-developer/redis-developer/edit/master/docs/howtos/shoppingcart/index-shoppingcart.mdx",version:"current",sidebar_label:"How to build a Shopping cart app using NodeJS and RedisJSON",sidebar:"docs",previous:{title:"RedisGears Tutorial",permalink:"/howtos/redisgears"},next:{title:"How to build a Real-Time Leaderboard app Using Redis",permalink:"/howtos/leaderboard"}},c=[{value:"Content",id:"content",children:[]},{value:"What will you build?",id:"what-will-you-build",children:[]},{value:"What do you need?",id:"what-do-you-need",children:[]},{value:"Getting Started",id:"getting-started",children:[]},{value:"Setting up the backend server",id:"setting-up-the-backend-server",children:[]},{value:"Setting up the frontend web Client using Vue.js",id:"setting-up-the-frontend-web-client-using-vuejs",children:[]},{value:"Running/Testing the web client",id:"runningtesting-the-web-client",children:[]},{value:"Conclusion",id:"conclusion",children:[]},{value:"Reference",id:"reference",children:[]}],d={toc:c};function l(e){var t=e.components,s=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},d,s,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"It\u2019s hard to imagine an online store without a shopping cart. Almost every online store must have the shopping cart functionality to be able to sell products to customers. In order to build a scalable ecommerce platform, you need a powerful framework and a simple storage system. At times, a lot of developers focus on improving the frontend performance of an ecommerce platform to rectify these things. The real bottleneck, however, remains the slow backend load time.\nA slow backend load time can have a serious impact on your search engine rankings. A good rule of thumb is that backend load time should take no more than 20% of your total load time. A good backend load time to aim for is 200ms or less.\nIn this tutorial, you will see how to build a shopping cart application using Node.js, Vue.js, Express and Redis."),Object(o.b)("p",null,Object(o.b)("img",{alt:"My Image",src:n(387).default})),Object(o.b)("h3",{id:"content"},"Content"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"What will you build?"),Object(o.b)("li",{parentName:"ul"},"What do you need?"),Object(o.b)("li",{parentName:"ul"},"Getting started"),Object(o.b)("li",{parentName:"ul"},"Setting up the backend (Node.js Express)"),Object(o.b)("li",{parentName:"ul"},"Setting up the frontend (Vue.js)"),Object(o.b)("li",{parentName:"ul"},"Running the application"),Object(o.b)("li",{parentName:"ul"},"Conclusion")),Object(o.b)("h3",{id:"what-will-you-build"},"What will you build?"),Object(o.b)("p",null,"This tutorial will show you how to harness the power of Redis by creating a basic ecommerce shopping cart application with Node.js. Usually, the shopping cart data is stored on the client-side as a cookie. Cookies are small text files stored in a web user's browser directory or data folder. The advantage of doing this is that you wouldn't need to store such temporary data in your database. However, this will require you to send the cookies with every web request, which can slow down the request in case of large cookies. Storing shopping cart data in Redis is a good idea since you can retrieve the items very fast at any time and persist this data if needed."),Object(o.b)("p",null,Object(o.b)("img",{alt:"Shopping Cart",src:n(388).default})),Object(o.b)("h3",{id:"what-do-you-need"},"What do you need?"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Redis compiled with RedisJSON module"),Object(o.b)("li",{parentName:"ul"},"Express 4 backend"),Object(o.b)("li",{parentName:"ul"},"Node 15.5.0 (at least v12.9.0+)"),Object(o.b)("li",{parentName:"ul"},"NPM 7.3.0 (at least v6.14.8+)"),Object(o.b)("li",{parentName:"ul"},"Docker 19.03.X (Optional)"),Object(o.b)("li",{parentName:"ul"},"Docker Compose (Optional)")),Object(o.b)("p",null,"Building an ecommerce app with Node.js makes a lot more sense because it ensures the balance between frontend and backend load time due to its asynchronous nature (the ability to handle multiple concurrent users at a time). Node.js helps developers make the best use of event loops and callbacks for I/O operations. Node.js runs single-threaded, non-blocking, asynchronous programming, which is very memory efficient."),Object(o.b)("p",null,"In order to create a shopping cart we need a simple storage system where we can collect products and the cart's total. Node.js provides us with the express-session package, middleware for ExpressJS. We will be using express-session middleware to manage sessions in Node.js The session is stored in the express server itself."),Object(o.b)("p",null,"The default server-side session storage, MemoryStore, is purposely not designed for a production environment. It will leak memory under most conditions, does not scale past a single process, and is meant for debugging and developing. To manage multiple sessions for multiple users, we have to create a global map and put each session object to it. Global variables in NodeJs are memory consuming and can prove to be terrible security holes in production-level projects.This can be solved by using an external session store. We have to store every session in the store so that each one will belong to only a single user. One popular session store is built using Redis."),Object(o.b)("p",null,"We will start by setting up the backend for our application. Let\u2019s create a new directory for our application and initialize a new Node.js application. Open up your terminal and type the following:"),Object(o.b)("h3",{id:"getting-started"},"Getting Started"),Object(o.b)("p",null,"Clone the repository:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"$ git clone https://github.com/redis-developer/basic-redis-shopping-chart-nodejs\n")),Object(o.b)("h4",{id:"compiling-redis-with-redisjson-module"},"Compiling Redis with RedisJSON module"),Object(o.b)("p",null,"You can use the below docker compose file to run Redis server compiled with RedisJSON module:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),'version: \'3\'\n\nservices:\n    redis:\n        image: redislabs/rejson:latest\n        container_name: redis.redisshoppingcart.docker\n        restart: unless-stopped\n        environment:\n            REDIS_PASSWORD: ${REDIS_PASSWORD}\n        command: redis-server --loadmodule "/usr/lib/redis/modules/rejson.so" --requirepass "$REDIS_PASSWORD"\n        ports:\n            - 127.0.0.1:${REDIS_PORT}:6379\n        networks:\n            - global\nnetworks:\n    global:\n        external: true\n')),Object(o.b)("p",null,"I assume that you have Docker and Docker Compose up and installed on your local environment. Execute the below compose CLI to bring up Redis server:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"$ docker network create global \n$ docker-compose up -d --build\n")),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"docker-compose ps")," shows the list of running Redis services:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"$ docker-compose ps\nName                           Command               State          Ports          \n\nredis.redisshoppingcart.docker   docker-entrypoint.sh redis ...   Up      127.0.0.1:55000->6379/tcp\n")),Object(o.b)("h3",{id:"setting-up-the-backend-server"},"Setting up the backend server"),Object(o.b)("p",null,Object(o.b)("img",{alt:"Shopping",src:n(389).default})),Object(o.b)("p",null,"Node.js is a runtime environment that allows software developers to launch both the frontend and backend of web apps using JavaScript. To save your time, the directory /server/src has already been created for you.This is where we will be creating our modules by adding the following sub-directories -"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"routes"),Object(o.b)("li",{parentName:"ul"},"controller"),Object(o.b)("li",{parentName:"ul"},"middleware"),Object(o.b)("li",{parentName:"ul"},"services")),Object(o.b)("p",null,"Routes forward the supported requests (and any information encoded in request URLs) to the appropriate controller functions, whereas controller functions get the requested data from the models, create an HTML page displaying the data, and return it to the user to view in the browser. Services hold your actual business logic. Middleware functions are functions that have access to the request object (req), the response object (res), and the next middleware function in the application\u2019s request-response cycle."),Object(o.b)("h4",{id:"project-directory-structure"},"Project directory structure"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"% tree\n.\n\u251c\u2500\u2500 controllers\n\u2502   \u251c\u2500\u2500 Cart\n\u2502   \u2502   \u251c\u2500\u2500 DeleteItemController.js\n\u2502   \u2502   \u251c\u2500\u2500 EmptyController.js\n\u2502   \u2502   \u251c\u2500\u2500 IndexController.js\n\u2502   \u2502   \u2514\u2500\u2500 UpdateController.js\n\u2502   \u2514\u2500\u2500 Product\n\u2502       \u251c\u2500\u2500 IndexController.js\n\u2502       \u2514\u2500\u2500 ResetController.js\n\u251c\u2500\u2500 index.js\n\u251c\u2500\u2500 middleware\n\u2502   \u2514\u2500\u2500 checkSession.js\n\u251c\u2500\u2500 products.json\n\u251c\u2500\u2500 routes\n\u2502   \u251c\u2500\u2500 cart.js\n\u2502   \u251c\u2500\u2500 index.js\n\u2502   \u2514\u2500\u2500 products.js\n\u2514\u2500\u2500 services\n    \u2514\u2500\u2500 RedisClient.js\n\n6 directories, 13 files\n")),Object(o.b)("p",null,"Let us first initialize the application server through the index.js shown below:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"// server/src/index.js\n\n\nconst express = require('express');\nconst redis = require('redis');\nconst rejson = require('redis-rejson');\nconst session = require('express-session');\nconst RedisStore = require('connect-redis')(session);\nconst path = require('path');\nconst bodyParser = require('body-parser');\nconst cors = require('cors');\nconst RedisClient = require('./services/RedisClient');\n\nrejson(redis);\n\nrequire('dotenv').config();\n\nconst { REDIS_ENDPOINT_URI, REDIS_HOST, REDIS_PORT, REDIS_PASSWORD, PORT } = process.env;\n\nconst app = express();\n\napp.use(\n    cors({\n        origin(origin, callback) {\n            callback(null, true);\n        },\n        credentials: true\n    })\n);\n\nconst redisEndpointUri = REDIS_ENDPOINT_URI\n    ? REDIS_ENDPOINT_URI.replace(/^(redis\\:\\/\\/)/, '')\n    : `${REDIS_HOST}:${REDIS_PORT}`;\n\nconst redisClient = redis.createClient(`redis://${redisEndpointUri}`, {\n    password: REDIS_PASSWORD\n});\n\nconst redisClientService = new RedisClient(redisClient);\n\napp.set('redisClientService', redisClientService);\n\napp.use(\n    session({\n        store: new RedisStore({ client: redisClient }),\n        secret: 'someSecret',\n        resave: false,\n        saveUninitialized: false,\n        rolling: true,\n        cookie: {\n            maxAge: 3600 * 1000 * 3\n        }\n    })\n);\n\napp.use(bodyParser.json());\n\napp.use('/', express.static(path.join(__dirname, '../../client-dist')));\n\nconst router = require('./routes')(app);\n\napp.use('/api', router);\n\nconst port = PORT || 3000;\n\napp.listen(port, () => {\n    console.log(`App listening on port ${port}`);\n});\n")),Object(o.b)("p",null,"You'll see that the responsibility of this index.js is to simply set up the server. It initializes all the middleware, sets up the view engine, etc. The last thing to do is set up routes by deferring that responsibility to the index.js within the routes folder."),Object(o.b)("p",null,"As shown above, app.use, app.set, and app.listen are endpoints, for the purposes of this demo, we will need to be able to add and get items from the basket ( Keeping it simple ).\nWe need to define our basic routes to get all products, get single product details, remove products, and create products. "),Object(o.b)("h4",{id:"routes"},"Routes"),Object(o.b)("p",null,"The routes directory is only responsible for defining our routes. Within index.js in this folder, you'll see that its responsibility is to set up our top level routes and delegate their responsibilities to each of their respective route files. Each respective route file will further define any additional subroutes and controller actions for each one."),Object(o.b)("p",null,"The web server skeleton already has a ./routes folder containing routes for the index, products and cart. (as shown under ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/redis-developer/basic-redis-shopping-chart-nodejs/tree/main/server/src/routes"}),"https://github.com/redis-developer/basic-redis-shopping-chart-nodejs/tree/main/server/src/routes"),")   "),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"// routes/index.js\n\nconst fs = require('fs');\nconst express = require('express');\nconst router = express.Router();\n\nmodule.exports = app => {\n    fs.readdirSync(__dirname).forEach(function (route) {\n        route = route.split('.')[0];\n\n        if (route === 'index') {\n            return;\n        }\n\n        router.use(`/${route}`, require(`./${route}`)(app));\n    });\n\n    return router;\n};\n")),Object(o.b)("p",null,"A route is a section of Express code that associates an HTTP verb (GET, POST, PUT, DELETE, etc.), a URL path/pattern, and a function that is called to handle that pattern.\nThere are several ways to create routes. For this demo app we're going to use the express.Router middleware as it allows us to group the route handlers for a particular part of a site together and access them using a common route-prefix.\nThe module requires Express and then uses it to create a Router object. The routes are all set up on the router, which is then exported.The routes are defined either using .get() or .post() methods on the router object. All the paths are defined using strings (we don't use string patterns or regular expressions). Routes that act on some specific resource (e.g. book) use path parameters to get the object id from the URL.\nThe handler functions are all imported from the controller modules we created in the previous section."),Object(o.b)("h4",{id:"controllers"},"Controllers"),Object(o.b)("p",null,"Controllers are responsible for invoking the appropriate action. If a controller's responsibility is to render a view, it will render the appropriate view from the app/views directory."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"// controller/Product/IndexController.js\n\n\nconst { products } = require('../../products.json');\n\nclass ProductIndexController {\n    constructor(redisClientService) {\n        this.redisClientService = redisClientService;\n    }\n\n    async index(req, res) {\n        const productKeys = await this.redisClientService.scan('product:*');\n        const productList = [];\n\n        if (productKeys.length) {\n            for (const key of productKeys) {\n                const product = await this.redisClientService.jsonGet(key);\n\n                productList.push(JSON.parse(product));\n            }\n\n            return res.send(productList);\n        }\n\n        for (const product of products) {\n            const { id } = product;\n\n            await this.redisClientService.jsonSet(`product:${id}`, '.', JSON.stringify(product));\n\n            productList.push(product);\n        }\n\n        return res.send(productList);\n    }\n}\n\nmodule.exports = ProductIndexController;\n")),Object(o.b)("h4",{id:"services"},"Services"),Object(o.b)("p",null,"Services hold your actual business logic.The service layer carries out the application logic and delegates CRUD operations to a database/persistent storage (Redis in our case). Let us look at each condition and try to understand how the data is stored, modified, and accessed:"),Object(o.b)("h4",{id:"how-the-data-is-stored"},"How the data is stored:"),Object(o.b)("p",null,"The product data is stored in an external JSON file. After the first request, this data is saved in a JSON data type in Redis like: "),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),'JSON.SET product:{productId} . \'{ "id": "productId", "name": "Product Name", "price": "375.00", "stock": 10 }\'.\n')),Object(o.b)("h4",{id:"example"},"Example:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),'JSON.SET product:e182115a-63d2-42ce-8fe0-5f696ecdfba6 . \'{ "id": "e182115a-63d2-42ce-8fe0-5f696ecdfba6", "name": "Brilliant Watch", "price": "250.00", "stock": 2 }\'\n')),Object(o.b)("p",null,"The cart data is stored in a hash like: "),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"HSET cart:{cartId} product:{productId} {productQuantity}, \n")),Object(o.b)("p",null,"where cartId is a random generated value and stored in the user session. Please note that Redis\u2019s hash management command HSET stores 2 keys-cart and product-as shown in the below example."),Object(o.b)("h4",{id:"example-1"},"Example:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"HSET cart:77f7fc881edc2f558e683a230eac217d product:e182115a-63d2-42ce-8fe0-5f696ecdfba6 1\n")),Object(o.b)("h4",{id:"how-the-data-is-modified"},"How the data is modified:"),Object(o.b)("p",null,"The product data is modified like "),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),'JSON.SET product:{productId} . \'{ "id": "productId", "name": "Product Name", "price": "375.00", "stock": {newStock} }\'.\n')),Object(o.b)("h4",{id:"example-2"},"Example:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),'JSON.SET product:e182115a-63d2-42ce-8fe0-5f696ecdfba6 . \'{ "id": "e182115a-63d2-42ce-8fe0-5f696ecdfba6", "name": "Brilliant Watch", "price": "250.00", "stock": 1 }\'\n')),Object(o.b)("p",null,"The cart data is modified like "),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"HSET cart:{cartId} product:{productId} {newProductQuantity} or HINCRBY cart:{cartId} product:{productId} {incrementBy}.\n")),Object(o.b)("h4",{id:"example-3"},"Example:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"HSET cart:77f7fc881edc2f558e683a230eac217d product:e182115a-63d2-42ce-8fe0-5f696ecdfba6 2\n\nHINCRBY cart:77f7fc881edc2f558e683a230eac217d product:e182115a-63d2-42ce-8fe0-5f696ecdfba6 1\n\nHINCRBY cart:77f7fc881edc2f558e683a230eac217d product:e182115a-63d2-42ce-8fe0-5f696ecdfba6 -1\n")),Object(o.b)("p",null,"The product can be removed from the cart like "),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"HDEL cart:{cartId} product:{productId}\n")),Object(o.b)("h4",{id:"example-4"},"Example:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"HDEL cart:77f7fc881edc2f558e683a230eac217d product:e182115a-63d2-42ce-8fe0-5f696ecdfba6\n")),Object(o.b)("p",null,"The cart can be cleared using "),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"HGETALL cart:{cartId} and then HDEL cart:{cartId} {productKey} in loop.\n")),Object(o.b)("h4",{id:"example-5"},"Example:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"HGETALL cart:77f7fc881edc2f558e683a230eac217d => product:e182115a-63d2-42ce-8fe0-5f696ecdfba6, product:f9a6d214-1c38-47ab-a61c-c99a59438b12, product:1f1321bb-0542-45d0-9601-2a3d007d5842 => HDEL cart:77f7fc881edc2f558e683a230eac217d product:e182115a-63d2-42ce-8fe0-5f696ecdfba6, HDEL cart:77f7fc881edc2f558e683a230eac217d product:f9a6d214-1c38-47ab-a61c-c99a59438b12, HDEL cart:77f7fc881edc2f558e683a230eac217d product:1f1321bb-0542-45d0-9601-2a3d007d5842\n")),Object(o.b)("p",null,"All carts can be deleted when reset data is requested like: "),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{})," SCAN {cursor} MATCH cart:* and then DEL cart:{cartId} in loop.\n")),Object(o.b)("h4",{id:"example-6"},"Example:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{})," SCAN {cursor} MATCH cart:* => cart:77f7fc881edc2f558e683a230eac217d, cart:217dedc2f558e683a230eac77f7fc881, cart:1ede77f558683a230eac7fc88217dc2f => DEL cart:77f7fc881edc2f558e683a230eac217d, DEL cart:217dedc2f558e683a230eac77f7fc881, DEL cart:1ede77f558683a230eac7fc88217dc2f\n")),Object(o.b)("h4",{id:"how-the-data-is-accessed"},"How the data is accessed:"),Object(o.b)("p",null,"Products: SCAN {cursor} MATCH product:* to get all product keys and then JSON.GET {productKey}"),Object(o.b)("h4",{id:"example-7"},"Example:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"SCAN {cursor} MATCH product:* => product:e182115a-63d2-42ce-8fe0-5f696ecdfba6, product:f9a6d214-1c38-47ab-a61c-c99a59438b12, product:1f1321bb-0542-45d0-9601-2a3d007d5842 \n=> JSON.GET product:e182115a-63d2-42ce-8fe0-5f696ecdfba6, JSON.GET product:f9a6d214-1c38-47ab-a61c-c99a59438b1, JSON.GET product:1f1321bb-0542-45d0-9601-2a3d007d5842\n")),Object(o.b)("p",null,"Cart: HGETALL cart:{cartId} to get quantity of products and JSON.GET product:{productId} to get products data in loop."),Object(o.b)("h4",{id:"example-8"},"Example:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"HGETALL cart:77f7fc881edc2f558e683a230eac217d => product:e182115a-63d2-42ce-8fe0-5f696ecdfba6 (quantity: 1), product:f9a6d214-1c38-47ab-a61c-c99a59438b12 (quantity: 0), product:1f1321bb-0542-45d0-9601-2a3d007d5842 (quantity: 2) => JSON.GET product:e182115a-63d2-42ce-8fe0-5f696ecdfba6, JSON.GET product:f9a6d214-1c38-47ab-a61c-c99a59438b12, JSON.GET product:1f1321bb-0542-45d0-9601-2a3d007d5842\n")),Object(o.b)("p",null,"HGETALL returns an array of keys and corresponding values from hash data type.\nOpen up RedisClient.js file using your favourite editor as shown below:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"// services/RedisClient.js\n\nconst { promisify } = require('util');\n\nclass RedisClient {\n    constructor(redisClient) {\n        ['json_get', 'json_set', 'hgetall', 'hset', 'hget', 'hdel', 'hincrby', 'del', 'scan'].forEach(\n            method => (redisClient[method] = promisify(redisClient[method]))\n        );\n        this.redis = redisClient;\n    }\n\n    async scan(pattern) {\n        let matchingKeysCount = 0;\n        let keys = [];\n\n        const recursiveScan = async (cursor = '0') => {\n            const [newCursor, matchingKeys] = await this.redis.scan(cursor, 'MATCH', pattern);\n            cursor = newCursor;\n\n            matchingKeysCount += matchingKeys.length;\n            keys = keys.concat(matchingKeys);\n\n            if (cursor === '0') {\n                return keys;\n            } else {\n                return await recursiveScan(cursor);\n            }\n        };\n\n        return await recursiveScan();\n    }\n\n    jsonGet(key) {\n        return this.redis.json_get(key);\n    }\n\n    jsonSet(key, path, json) {\n        return this.redis.json_set(key, path, json);\n    }\n\n    hgetall(key) {\n        return this.redis.hgetall(key);\n    }\n\n    hset(hash, key, value) {\n        return this.redis.hset(hash, key, value);\n    }\n\n    hget(hash, key) {\n        return this.redis.hget(hash, key);\n    }\n\n    hdel(hash, key) {\n        return this.redis.hdel(hash, key);\n    }\n\n    hincrby(hash, key, incr) {\n        return this.redis.hincrby(hash, key, incr);\n    }\n\n    del(key) {\n        return this.redis.del(key);\n    }\n}\n\nmodule.exports = RedisClient;\n")),Object(o.b)("h4",{id:"how-does-the-overall-process-work"},"How does the overall process work?"),Object(o.b)("p",null,"The process flow is fairly straightforward. Once a request is sent to an endpoint on this shopping cart application e.g http://localhost:8081/. It first hits the router for that endpoint and then if it is a public endpoint such as this one it goes to the controller that handles that.  As an analogy, the controller is just like a manager, while the service is the worker. A controller manages the incoming work HTTP requests whereas services receives the request data it needs from the manager in order to perform its tasks"),Object(o.b)("p",null,"Next, we create routes for a cart in a module named cart.js. The code first imports the Express application object, uses it to get a Router object and then adds a couple of routes to it using the get() method. Last of all the module returns the Router object."),Object(o.b)("p",null,"First let us define the product model to our controllers/Product/IndexController.js file(",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/redis-developer/basic-redis-shopping-chart-nodejs/tree/main/server/src/controllers/Product"}),"https://github.com/redis-developer/basic-redis-shopping-chart-nodejs/tree/main/server/src/controllers/Product"),"):"),Object(o.b)("p",null,"Our product model will be basic as possible as it holds the product name, price and image."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),'{\n    "products": [\n        {\n            "id": "e182115a-63d2-42ce-8fe0-5f696ecdfba6",\n            "name": "Brilliant Watch",\n            "price": "250.00",\n            "stock": 2\n        },\n        {\n            "id": "f9a6d214-1c38-47ab-a61c-c99a59438b12",\n            "name": "Old fashion cellphone",\n            "price": "24.00",\n            "stock": 2\n        },\n        {\n            "id": "1f1321bb-0542-45d0-9601-2a3d007d5842",\n            "name": "Modern iPhone",\n            "price": "1000.00",\n            "stock": 2\n        },\n        {\n            "id": "f5384efc-eadb-4d7b-a131-36516269c218",\n            "name": "Beautiful Sunglasses",\n            "price": "12.00",\n            "stock": 2\n        },\n        {\n            "id": "6d6ca89d-fbc2-4fc2-93d0-6ee46ae97345",\n            "name": "Stylish Cup",\n            "price": "8.00",\n            "stock": 2\n        },\n        {\n            "id": "efe0c7a3-9835-4dfb-87e1-575b7d06701a",\n            "name": "Herb caps",\n            "price": "12.00",\n            "stock": 2\n        },\n        {\n            "id": "x341115a-63d2-42ce-8fe0-5f696ecdfca6",\n            "name": "Audiophile Headphones",\n            "price": "550.00",\n            "stock": 2\n        },\n        {\n            "id": "42860491-9f15-43d4-adeb-0db2cc99174a",\n            "name": "Digital Camera",\n            "price": "225.00",\n            "stock": 2\n        },\n        {\n            "id": "63a3c635-4505-4588-8457-ed04fbb76511",\n            "name": "Empty Bluray Disc",\n            "price": "5.00",\n            "stock": 2\n        },\n        {\n            "id": "97a19842-db31-4537-9241-5053d7c96239",\n            "name": "256BG Pendrive",\n            "price": "60.00",\n            "stock": 2\n        }\n    ]\n}\n')),Object(o.b)("h4",{id:"testing-the-server"},"Testing the Server"),Object(o.b)("p",null,"Copy ",Object(o.b)("inlineCode",{parentName:"p"},".env.example")," to ",Object(o.b)("inlineCode",{parentName:"p"},".env")," file and fill environmental variables as shown below:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"REDIS_PORT=6379\nREDIS_HOST=127.0.0.1\nREDIS_PASSWORD=demo\n\nCOMPOSE_PROJECT_NAME=redis-shopping-cart\n")),Object(o.b)("p",null,"(Note: In case you\u2019re using Redis Enterprise Cloud instead of localhost, then you need to enter the database endpoint under REDIS_HOST(without port) while rest of the entries like REDIS_PORT and REDIS_PASSWORD are quite obvious)"),Object(o.b)("h4",{id:"installing-the-dependencies"},"Installing the dependencies"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"$ npm install\n")),Object(o.b)("h4",{id:"testing-the-routes"},"Testing the Routes"),Object(o.b)("p",null,"After adding this, you can run your application by typing npm install in your terminal. Once you run this command, it will return Application is running on 3000."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"$ npm run dev\n")),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"$ npm run dev\n\n> redis-shopping-cart-backend@1.0.0 dev\n> nodemon src/index.js\n\n[nodemon] 2.0.7\n[nodemon] to restart at any time, enter `rs`\n[nodemon] watching path(s): *.*\n[nodemon] watching extensions: js,mjs,json\n[nodemon] starting `node src/index.js`\nApp listening on port 3000\n")),Object(o.b)("h3",{id:"setting-up-the-frontend-web-client-using-vuejs"},"Setting up the frontend web Client using Vue.js"),Object(o.b)("p",null,"Now that we have the application\u2019s backend running, let us begin developing its frontend. We will be leveraging Vue.js - a robust but simple JavaScript framework for building our frontend web client. It has one of the lowest barriers to entry of any modern framework while providing all the required features for high performance web applications."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),".\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 babel.config.js\n\u251c\u2500\u2500 node_modules\n\u251c\u2500\u2500 package-lock.json\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 public\n\u251c\u2500\u2500 src\n\u2514\u2500\u2500 vue.config.js\n")),Object(o.b)("p",null,"The files at the root level (babel.config.js, package.json, node_modules) are used to configure the project.\nThe most interesting part, at least for now, is located in the src directory(directory structure is shown below):"),Object(o.b)("p",null,"The main.js file is the main JavaScript file of the application, which will load all common elements and call the App.vue main screen.\nThe App.vue is a file that contains in the HTML, CSS, and JavaScript for a specific page or template. As an entry point for the application, this part is shared by all screens by default, so it is a good place to write the notification-client piece in this file.\nThe public/index.html is the static entry point from where the DOM will be loaded. "),Object(o.b)("h4",{id:"directory-structure"},"Directory Structure:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"% tree\n.\n\u251c\u2500\u2500 App.vue\n\u251c\u2500\u2500 assets\n\u2502   \u251c\u2500\u2500 RedisLabs_Illustration.svg\n\u2502   \u2514\u2500\u2500 products\n\u2502       \u251c\u2500\u2500 1f1321bb-0542-45d0-9601-2a3d007d5842.jpg\n\u2502       \u251c\u2500\u2500 42860491-9f15-43d4-adeb-0db2cc99174a.jpg\n\u2502       \u251c\u2500\u2500 63a3c635-4505-4588-8457-ed04fbb76511.jpg\n\u2502       \u251c\u2500\u2500 6d6ca89d-fbc2-4fc2-93d0-6ee46ae97345.jpg\n\u2502       \u251c\u2500\u2500 97a19842-db31-4537-9241-5053d7c96239.jpg\n\u2502       \u251c\u2500\u2500 e182115a-63d2-42ce-8fe0-5f696ecdfba6.jpg\n\u2502       \u251c\u2500\u2500 efe0c7a3-9835-4dfb-87e1-575b7d06701a.jpg\n\u2502       \u251c\u2500\u2500 f5384efc-eadb-4d7b-a131-36516269c218.jpg\n\u2502       \u251c\u2500\u2500 f9a6d214-1c38-47ab-a61c-c99a59438b12.jpg\n\u2502       \u2514\u2500\u2500 x341115a-63d2-42ce-8fe0-5f696ecdfca6.jpg\n\u251c\u2500\u2500 components\n\u2502   \u251c\u2500\u2500 Cart.vue\n\u2502   \u251c\u2500\u2500 CartItem.vue\n\u2502   \u251c\u2500\u2500 CartList.vue\n\u2502   \u251c\u2500\u2500 Info.vue\n\u2502   \u251c\u2500\u2500 Product.vue\n\u2502   \u251c\u2500\u2500 ProductList.vue\n\u2502   \u2514\u2500\u2500 ResetDataBtn.vue\n\u251c\u2500\u2500 config\n\u2502   \u2514\u2500\u2500 index.js\n\u251c\u2500\u2500 main.js\n\u251c\u2500\u2500 plugins\n\u2502   \u251c\u2500\u2500 axios.js\n\u2502   \u2514\u2500\u2500 vuetify.js\n\u251c\u2500\u2500 store\n\u2502   \u251c\u2500\u2500 index.js\n\u2502   \u2514\u2500\u2500 modules\n\u2502       \u251c\u2500\u2500 cart.js\n\u2502       \u2514\u2500\u2500 products.js\n\u2514\u2500\u2500 styles\n    \u2514\u2500\u2500 styles.scss\n\n8 directories, 27 files\n")),Object(o.b)("p",null,"In the client directory, under the subdirectory src, open the file App.vue. You will see the below content:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),'<template>\n    <v-app>\n        <v-container>\n            <div class="my-8 d-flex align-center">\n                <div class="pa-4 rounded-lg red darken-1">\n                    <v-icon color="white" size="45">mdi-cart-plus</v-icon>\n                </div>\n                <h1 class="ml-6 font-weight-regular">Shopping Cart demo</h1>\n            </div>\n        </v-container>\n\n        <v-container>\n            <v-row>\n                <v-col cols="12" sm="7" md="8">\n                    <info />\n                    <product-list :products="products" />\n                </v-col>\n                <v-col cols="12" sm="5" md="4" class="d-flex flex-column">\n                    <cart />\n                    <reset-data-btn class="mt-6" />\n                </v-col>\n            </v-row>\n\n            <v-footer class="mt-12 pa-0">\n                \xa9 Copyright 2021 | All Rights Reserved to Redis Labs\n            </v-footer>\n        </v-container>\n    </v-app>\n</template>\n\n<script>\nimport { mapGetters, mapActions } from \'vuex\';\nimport Cart from \'@/components/Cart\';\nimport ProductList from \'@/components/ProductList\';\nimport ResetDataBtn from \'@/components/ResetDataBtn.vue\';\nimport Info from \'@/components/Info\';\n\nexport default {\n    name: \'App\',\n\n    components: {\n        ProductList,\n        Cart,\n        ResetDataBtn,\n        Info\n    },\n\n    computed: {\n        ...mapGetters({\n            products: \'products/getProducts\'\n        })\n    },\n\n    async created() {\n        await this.fetchProducts();\n    },\n\n    methods: {\n        ...mapActions({\n            fetchProducts: \'products/fetch\'\n        })\n    }\n};\n<\/script>\n')),Object(o.b)("p",null,"This is client-side code. Here API returns, among other things, links to icons suitable for use on Maps. If you follow the flow through, you\u2019ll see the map markers are loading those icons directly using the include URLs."),Object(o.b)("h3",{id:"runningtesting-the-web-client"},"Running/Testing the web client"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"$ cd client\n$ npm run serve \n\n> redis-shopping-cart-client@1.0.0 serve\n> vue-cli-service serve\n\n INFO  Starting development server...\n98% after emitting CopyPlugin\n\n DONE  Compiled successfully in 7733ms                                                                                                                              7:15:56 AM\n\n\n  App running at:\n  - Local:   http://localhost:8081/ \n  - Network: http://192.168.43.81:8081/\n\n  Note that the development build is not optimized.\n  To create a production build, run npm run build.\n")),Object(o.b)("p",null,"Let us click on the first item \u201c256GB Pendrive\u201d and try to check out this product. Once you add it to the cart, you will see the below output using redis-cli monitor command:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),'1613320256.801562 [0 172.22.0.1:64420] "json.get" "product:97a19842-db31-4537-9241-5053d7c96239"\n1613320256.803062 [0 172.22.0.1:64420] "hget" \n...\n1613320256.805950 [0 172.22.0.1:64420] "json.set" "product:97a19842-db31-4537-9241-5053d7c96239" "." "{\\"id\\":\\"97a19842-db31-4537-9241-5053d7c96239\\",\\"name\\":\\"256BG Pendrive\\",\\"price\\":\\"60.00\\",\\"stock\\":1}"\n1613320256.807792 [0 172.22.0.1:64420] "set" "sess:Ii9njXZd6zeUViL3tKJimN5zU7Samfze" \n...\n1613320256.823055 [0 172.22.0.1:64420] "scan" "0" "MATCH" "product:*"\n...\n1613320263.232527 [0 172.22.0.1:64420] "hgetall" "cart:bdee1606395f69985e8f8e01d3ada8c4"\n1613320263.233752 [0 172.22.0.1:64420] "set" "sess:gXk5K9bobvrR790-HFEoi3bQ2kP9YmjV" "{\\"cookie\\":{\\"originalMaxAge\\":10800000,\\"expires\\":\\"2021-02-14T19:31:03.233Z\\",\\"httpOnly\\":true,\\"path\\":\\"/\\"},\\"cartId\\":\\"bdee1606395f69985e8f8e01d3ada8c4\\"}" "EX" "10800"\n1613320263.240797 [0 172.22.0.1:64420] "scan" "0" "MATCH" "product:*"\n1613320263.241908 [0 172.22.0.1:64420] "scan" "22" "MATCH" "product:*"\n\u2026\n"{\\"cookie\\":{\\"originalMaxAge\\":10800000,\\"expires\\":\\"2021-02-14T19:31:03.254Z\\",\\"httpOnly\\":true,\\"path\\":\\"/\\"},\\"cartId\\":\\"4bc231293c5345370f8fab83aff52cf3\\"}" "EX" "10800"\n')),Object(o.b)("p",null,Object(o.b)("img",{alt:"Shopping Cart",src:n(390).default})),Object(o.b)("h3",{id:"conclusion"},"Conclusion"),Object(o.b)("p",null,"Storing shopping cart data in Redis is a good idea because it lets you retrieve the data very fast at any time and persist this data if needed. As compared to cookies that store the entire shopping cart data in session that is bloated and relatively slow in operation, storing the shopping cart data in Redis speeds up the shopping cart\u2019s read and write performance , thereby improving the user experience."),Object(o.b)("h3",{id:"reference"},"Reference"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(r.a)({parentName:"li"},{href:"https://github.com/redis-developer/basic-redis-shopping-chart-nodejs"}),"Source code"))))}l.isMDXComponent=!0},170:function(e,t,n){"use strict";var r=n(0),a=n.n(r),o=n(168),s=n(176);n(169),n(55);t.a=function(e){var t=a.a.useState(!1),n=t[0],r=t[1];return a.a.createElement("div",{className:"ri-container"},a.a.createElement("div",{className:"ri-description-short"},a.a.createElement("div",{className:"ri-icon"},a.a.createElement("span",{className:"fe fe-zap"})),a.a.createElement("div",{className:"ri-detail"},a.a.createElement("div",{className:"ri-title"},a.a.createElement("a",{href:e.page},e.title)),a.a.createElement("div",{className:"ri-description"},e.description,a.a.Children.count(e.children)>0&&a.a.createElement("span",{className:"ri-more fe fe-more-horizontal",onClick:function(){return r(!n)}})))),n&&a.a.createElement("div",{className:"ri-description-long"},a.a.createElement(o.a,{components:s.a},e.children)))}},171:function(e,t,n){"use strict";var r=n(0),a=n(173);t.a=function(){var e=Object(r.useContext)(a.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},173:function(e,t,n){"use strict";var r=n(0),a=Object(r.createContext)(void 0);t.a=a},174:function(e,t,n){"use strict";var r=n(0),a=n.n(r),o=n(171),s=n(172),i=n(56),c=n.n(i),d=37,l=39;t.a=function(e){var t=e.lazy,n=e.block,i=e.defaultValue,p=e.values,u=e.groupId,b=e.className,h=Object(o.a)(),m=h.tabGroupChoices,f=h.setTabGroupChoices,j=Object(r.useState)(i),g=j[0],O=j[1],v=r.Children.toArray(e.children);if(null!=u){var w=m[u];null!=w&&w!==g&&p.some((function(e){return e.value===w}))&&O(w)}var y=function(e){O(e),null!=u&&f(u,e)},k=[];return a.a.createElement("div",null,a.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(s.a)("tabs",{"tabs--block":n},b)},p.map((function(e){var t=e.value,n=e.label;return a.a.createElement("li",{role:"tab",tabIndex:0,"aria-selected":g===t,className:Object(s.a)("tabs__item",c.a.tabItem,{"tabs__item--active":g===t}),key:t,ref:function(e){return k.push(e)},onKeyDown:function(e){!function(e,t,n){switch(n.keyCode){case l:!function(e,t){var n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()}(e,t);break;case d:!function(e,t){var n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()}(e,t)}}(k,e.target,e)},onFocus:function(){return y(t)},onClick:function(){y(t)}},n)}))),t?Object(r.cloneElement)(v.filter((function(e){return e.props.value===g}))[0],{className:"margin-vert--md"}):a.a.createElement("div",{className:"margin-vert--md"},v.map((function(e,t){return Object(r.cloneElement)(e,{key:t,hidden:e.props.value!==g})}))))}},175:function(e,t,n){"use strict";var r=n(3),a=n(0),o=n.n(a);t.a=function(e){var t=e.children,n=e.hidden,a=e.className;return o.a.createElement("div",Object(r.a)({role:"tabpanel"},{hidden:n,className:a}),t)}},387:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/shoppingcart-1ae861fff24a4ecbe0a32d4464c6b834.png"},388:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/shopping2-cdb4e24f67089759277bd37792e942e1.png"},389:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/shoppingcart3-1f2b38c7fed16271a55d4b4e93423f3f.png"},390:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/shoppingcart5-b53d75830ff124d1c50f7624e43c6147.png"}}]);