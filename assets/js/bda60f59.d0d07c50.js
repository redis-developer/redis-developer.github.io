"use strict";(self.webpackChunkredis_developer_hub=self.webpackChunkredis_developer_hub||[]).push([[7880],{3905:(e,t,r)=>{r.d(t,{Zo:()=>d,kt:()=>p});var i=r(67294);function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function n(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,i,s=function(e,t){if(null==e)return{};var r,i,s={},a=Object.keys(e);for(i=0;i<a.length;i++)r=a[i],t.indexOf(r)>=0||(s[r]=e[r]);return s}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)r=a[i],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}var o=i.createContext({}),c=function(e){var t=i.useContext(o),r=t;return e&&(r="function"==typeof e?e(t):n(n({},t),e)),r},d=function(e){var t=c(e.components);return i.createElement(o.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},h=i.forwardRef((function(e,t){var r=e.components,s=e.mdxType,a=e.originalType,o=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),h=c(r),p=s,b=h["".concat(o,".").concat(p)]||h[p]||u[p]||a;return r?i.createElement(b,n(n({ref:t},d),{},{components:r})):i.createElement(b,n({ref:t},d))}));function p(e,t){var r=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var a=r.length,n=new Array(a);n[0]=h;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l.mdxType="string"==typeof e?e:s,n[1]=l;for(var c=2;c<a;c++)n[c]=r[c];return i.createElement.apply(null,n)}return i.createElement.apply(null,r)}h.displayName="MDXCreateElement"},6818:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>o,contentTitle:()=>n,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var i=r(87462),s=(r(67294),r(3905));const a={id:"index-redis-cluster-and-client-libraries",title:"4.3 Redis Cluster and Client Libraries",sidebar_label:"4.3 Redis Cluster and Client Libraries",slug:"/operate/redis-at-scale/scalability/redis-cluster-and-client-libraries",custom_edit_url:null},n=void 0,l={unversionedId:"operate/redis-at-scale/scalability/redis-cluster-and-client-libraries/index-redis-cluster-and-client-libraries",id:"operate/redis-at-scale/scalability/redis-cluster-and-client-libraries/index-redis-cluster-and-client-libraries",title:"4.3 Redis Cluster and Client Libraries",description:"To use a client library with Redis Cluster, the client libraries need to be cluster-aware. Clients that support Redis Cluster typically feature a special connection module for managing connections to the cluster. The process that some of the better client libraries follow usually goes like this:",source:"@site/docs/operate/redis-at-scale/scalability/redis-cluster-and-client-libraries/index-redis-cluster-and-client-libraries.mdx",sourceDirName:"operate/redis-at-scale/scalability/redis-cluster-and-client-libraries",slug:"/operate/redis-at-scale/scalability/redis-cluster-and-client-libraries",permalink:"/operate/redis-at-scale/scalability/redis-cluster-and-client-libraries",draft:!1,editUrl:null,tags:[],version:"current",lastUpdatedAt:1667495358,formattedLastUpdatedAt:"Nov 3, 2022",frontMatter:{id:"index-redis-cluster-and-client-libraries",title:"4.3 Redis Cluster and Client Libraries",sidebar_label:"4.3 Redis Cluster and Client Libraries",slug:"/operate/redis-at-scale/scalability/redis-cluster-and-client-libraries",custom_edit_url:null},sidebar:"docs",previous:{title:"4.2 Using Redis-CLI with a Redis Cluster",permalink:"/operate/redis-at-scale/scalability/redis-cli-with-redis-cluster"},next:{title:"5.0 Introduction to Observability",permalink:"/operate/redis-at-scale/observability/introduction"}},o={},c=[],d={toc:c};function u(e){let{components:t,...r}=e;return(0,s.kt)("wrapper",(0,i.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"To use a client library with Redis Cluster, the client libraries need to be cluster-aware. Clients that support Redis Cluster typically feature a special connection module for managing connections to the cluster. The process that some of the better client libraries follow usually goes like this:"),(0,s.kt)("p",null,"The client connects to any shard in the cluster and gets the addresses of the rest of the shards. The client also fetches a mapping of hash slots to shards so it can know where to look for a key in a specific hash slot. This hash slot map is cached locally."),(0,s.kt)("br",null),(0,s.kt)("img",{height:"85%",width:"85%",src:"https://s3.us-east-2.amazonaws.com/assets-university.redislabs.com/ru301/4.4/image1.png",alt:"Hash Slot Diagram"}),(0,s.kt)("br",null),(0,s.kt)("p",null,"When the client needs to read/write a key, it first runs the hashing function ",(0,s.kt)("inlineCode",{parentName:"p"},"(crc16)")," on the key name and then modulo divides by 16384, which results in the key\u2019s hash slot number."),(0,s.kt)("p",null,"In the example below the hash slot number for the key \u201cfoo\u201d is 12182. Then the client checks the hash slot number against the hash slot map to determine which shard it should connect to. In our example, the hash slot number 12182 lives on shard ",(0,s.kt)("inlineCode",{parentName:"p"},"127.0.0.1:7002"),"."),(0,s.kt)("p",null,"Finally, the client connects to the shard and finds the key it needs to work with."),(0,s.kt)("br",null),(0,s.kt)("img",{height:"85%",width:"85%",src:"https://s3.us-east-2.amazonaws.com/assets-university.redislabs.com/ru301/4.4/image2.png",alt:"Hash Slot Map Diagram"}),(0,s.kt)("br",null),(0,s.kt)("p",null,"If the topology of the cluster changes for any reason and the key has been moved, the shard will respond with an ",(0,s.kt)("inlineCode",{parentName:"p"},"(error) MOVED 15495 127.0.0.1:7006")," error, returning the address of the new shard responsible for that key. This indicates to the client that it needs to re-query the cluster for its topology and hash slot allocation, so it will do that and update its local hash slot map for future queries."),(0,s.kt)("p",null,"Not every client library has this extra logic built in, so when choosing a client library, make sure to look for ones with cluster support."),(0,s.kt)("p",null,"Another detail to check is if the client stores the hash slot map locally. If it doesn\u2019t, and it relies on the ",(0,s.kt)("inlineCode",{parentName:"p"},"(error) MOVED")," response to get the address of the right shard, you can expect to have a much higher latency than usual because your client may have to make two network requests instead of one for a big part of the requests."),(0,s.kt)("p",null,"Examples of clients that support Redis cluster:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Java: Jedis, Lettuce"),(0,s.kt)("li",{parentName:"ul"},".NET: StackExchange.Redis"),(0,s.kt)("li",{parentName:"ul"},"Go: Radix, go-redis/redis"),(0,s.kt)("li",{parentName:"ul"},"Node.js: node-redis, ioredis"),(0,s.kt)("li",{parentName:"ul"},"Python: redis-py")),(0,s.kt)("p",null,"Here's a list of Redis Clients: ",(0,s.kt)("a",{parentName:"p",href:"https://redis.io/clients"},"https://redis.io/clients")))}u.isMDXComponent=!0}}]);