"use strict";(self.webpackChunkredis_developer_hub=self.webpackChunkredis_developer_hub||[]).push([[6425],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var r=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var o=r.createContext({}),p=function(e){var t=r.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(o.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,o=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(n),m=i,h=u["".concat(o,".").concat(m)]||u[m]||d[m]||a;return n?r.createElement(h,l(l({ref:t},c),{},{components:n})):r.createElement(h,l({ref:t},c))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,l=new Array(a);l[0]=u;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s.mdxType="string"==typeof e?e:i,l[1]=s;for(var p=2;p<a;p++)l[p]=n[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},14353:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>p});var r=n(87462),i=(n(67294),n(3905));const a={id:"index-exercise-2",title:"3.4 Exercise - Sentinel Hands-on",sidebar_label:"3.4 Exercise - Sentinel Hands-on",slug:"/operate/redis-at-scale/high-availability/exercise-2",custom_edit_url:null},l=void 0,s={unversionedId:"operate/redis-at-scale/high-availability/exercise-2/index-exercise-2",id:"operate/redis-at-scale/high-availability/exercise-2/index-exercise-2",title:"3.4 Exercise - Sentinel Hands-on",description:"Step 1",source:"@site/docs/operate/redis-at-scale/high-availability/exercise-2/index-exercise-2.mdx",sourceDirName:"operate/redis-at-scale/high-availability/exercise-2",slug:"/operate/redis-at-scale/high-availability/exercise-2",permalink:"/operate/redis-at-scale/high-availability/exercise-2",draft:!1,editUrl:null,tags:[],version:"current",lastUpdatedAt:1667495358,formattedLastUpdatedAt:"Nov 3, 2022",frontMatter:{id:"index-exercise-2",title:"3.4 Exercise - Sentinel Hands-on",sidebar_label:"3.4 Exercise - Sentinel Hands-on",slug:"/operate/redis-at-scale/high-availability/exercise-2",custom_edit_url:null},sidebar:"docs",previous:{title:"3.3 Understanding Sentinels",permalink:"/operate/redis-at-scale/high-availability/understanding-sentinels"},next:{title:"4.0 Clustering In Redis",permalink:"/operate/redis-at-scale/scalability/lustering-in-redis"}},o={},p=[{value:"Step 1",id:"step-1",level:2},{value:"Step 2",id:"step-2",level:2},{value:"Step 3",id:"step-3",level:2},{value:"Step 4",id:"step-4",level:2},{value:"Step 5",id:"step-5",level:2},{value:"Step 6",id:"step-6",level:2}],c={toc:p};function d(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"step-1"},"Step 1"),(0,i.kt)("p",null,"If you still have the primary and replica instances we set up in the previous exercise (3.2) - great! We\u2019ll reuse them to create our Sentinel setup. If not - refer back to the ",(0,i.kt)("a",{parentName:"p",href:"/operate/redis-at-scale/high-availability/exercise-1"},"instructions")," and go through them again."),(0,i.kt)("p",null,"When done, you will have a primary Redis instance with one replica."),(0,i.kt)("h2",{id:"step-2"},"Step 2"),(0,i.kt)("p",null,"To initialise a Redis Sentinel, you need to provide a configuration file, so let\u2019s go ahead and create one:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ touch sentinel1.conf\n")),(0,i.kt)("p",null,"Open the file and paste in the following settings:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"port 5000\nsentinel monitor myprimary 127.0.0.1 6379 2\nsentinel down-after-milliseconds myprimary 5000\nsentinel failover-timeout myprimary 60000\nsentinel auth-pass myprimary a_strong_password\n")),(0,i.kt)("strong",null,"Breakdown of terms:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"port")," - The port on which the Sentinel should run"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"sentinel monitor")," - monitor the Primary on a specific IP address and port. Having the address of the Primary the Sentinels will be able to discover all the replicas on their own. The last argument on this line is the number of Sentinels needed for quorum. In our example - the number is 2."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"sentinel down-after-milliseconds")," - how many milliseconds should an instance be unreachable so that it\u2019s considered down"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"sentinel failover-timeout")," - if a Sentinel voted another Sentinel for the failover of a given master, it will wait this many milliseconds to try to failover the same master again."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"sentinel auth-pass")," - In order for Sentinels to connect to Redis server instances when they are configured with ",(0,i.kt)("inlineCode",{parentName:"li"},"requirepass"),", the Sentinel configuration must include the sentinel auth-pass directive.")),(0,i.kt)("h2",{id:"step-3"},"Step 3"),(0,i.kt)("p",null,"Make two more copies of this file - ",(0,i.kt)("inlineCode",{parentName:"p"},"sentinel2.conf")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"sentinel3.conf")," and edit them so that the ",(0,i.kt)("inlineCode",{parentName:"p"},"PORT")," configuration is set to 5001 and 5002, respectively."),(0,i.kt)("h2",{id:"step-4"},"Step 4"),(0,i.kt)("p",null,"Let\u2019s initialise the three Sentinels in three different terminal tabs:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# Tab 1\n$ redis-server ./sentinel1.conf --sentinel\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# Tab 2\n$ redis-server ./sentinel2.conf --sentinel\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# Tab3\n$ redis-server ./sentinel3.conf --sentinel\n")),(0,i.kt)("h2",{id:"step-5"},"Step 5"),(0,i.kt)("p",null,"If you connected to one of the Sentinels now you would be able to run many new commands that would give an error if run on a Redis instance. For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# Provides information about the Primary\nSENTINEL master myprimary\n\n# Gives you information about the replicas connected to the Primary\nSENTINEL replicas myprimary\n\n# Provides information on the other Sentinels\nSENTINEL sentinels myprimary\n\n# Provides the IP address of the current Primary\nSENTINEL get-master-addr-by-name myprimary\n")),(0,i.kt)("h2",{id:"step-6"},"Step 6"),(0,i.kt)("p",null,"If we killed the primary Redis instance now by pressing Ctrl+C or by running the ",(0,i.kt)("inlineCode",{parentName:"p"},"redis-cli -p 6379 DEBUG sleep 30")," command, we\u2019ll be able to observe in the Sentinels\u2019 logs that the failover process will start in about 5 seconds. If you run the command that returns the IP address of the Primary again you will see that the replica has been promoted to a Primary:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'redis> SENTINEL get-master-addr-by-name myprimary\n1) "127.0.0.1"\n2) "6380"\n')))}d.isMDXComponent=!0}}]);