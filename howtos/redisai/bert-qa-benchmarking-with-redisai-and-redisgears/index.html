<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-howtos/bert-qa-benchmarking/bert-qa-benchmarking-with-redisai-and-redisgears">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Benchmarks for BERT Large Question Answering inference for RedisAI and RedisGears | The Home of Redis Developers</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://developer.redis.com/howtos/redisai/bert-qa-benchmarking-with-redisai-and-redisgears"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Benchmarks for BERT Large Question Answering inference for RedisAI and RedisGears | The Home of Redis Developers"><meta data-rh="true" name="description" content="Explore the challenges and opportunities associated with deploying large BERT QA models inside Redis."><meta data-rh="true" property="og:description" content="Explore the challenges and opportunities associated with deploying large BERT QA models inside Redis."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="alternate" href="https://developer.redis.com/howtos/redisai/bert-qa-benchmarking-with-redisai-and-redisgears" hreflang="en"><link data-rh="true" rel="alternate" href="https://developer.redis.com/howtos/redisai/bert-qa-benchmarking-with-redisai-and-redisgears" hreflang="x-default"><link data-rh="true" rel="canonical" href="https://reference-architecture.ai/docs/bert-qa-benchmarking/"><script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-W8Z6BLQ",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script><link rel="stylesheet" href="/assets/css/styles.5cde2a06.css">
<link rel="preload" href="/assets/js/runtime~main.80864dfb.js" as="script">
<link rel="preload" href="/assets/js/main.853f37c5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>

<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W8Z6BLQ" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-1.png" alt="Redis Developer Hub logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo-1.png" alt="Redis Developer Hub logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"><div id="redis-sitesearch" class="redis-sitesearch redis-sitesearch-inline"><input class="redis-sitesearch-input"><div class="redis-sitesearch-result-list-wrapper"><ul class="redis-sitesearch-result-list"></ul><div class="redisearch-logo"></div></div></div></div><a class="navbar__item navbar__link" href="/create/rediscloud">Get started</a><a href="https://launchpad.redis.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Redis Launchpad<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://redis.com/try-free/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Try Free<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo-1.png" alt="Redis Developer Hub logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo-1.png" alt="Redis Developer Hub logo" class="themedImage_ToTc themedImage--dark_i4oU"></a><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Home</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/create">Create</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/develop">Develop</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/explore">Explore</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/operate">Operate</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/howtos">HowTos &amp; Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/howtos">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/howtos/redisearch">RediSearch Tutorial</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/howtos/redisjson/">RedisJSON Tutorial</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/howtos/redistimeseries/">RedisTimeSeries Tutorial</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/howtos/redisgraph/">RedisGraph Tutorial</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/howtos/redisbloom">Redis Bloom Tutorial</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/howtos/redisgears">RedisGears Tutorial</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/howtos/redisai/">RedisAI Tutorial</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/howtos/leaderboard">How to build a Real-Time Leaderboard app Using Redis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/howtos/ratelimiting">How to build a Rate Limiter using Redis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/howtos/caching">How to cache REST API responses Using Redis &amp; NodeJS</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/howtos/moviesdatabase/getting-started">How to list &amp; search Movies database using RediSearch</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/howtos/chatapp">How to build a Chat application using Redis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/howtos/frauddetection">How to build a Fraud Detection System using Redis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/howtos/redisgraphmovies">Building Movies database app using RedisGraph and NodeJS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/howtos/nlp">Building a Pipeline for Natural Language Processing using RedisGears</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/howtos/redisai/bert-qa-benchmarking-with-redisai-and-redisgears">Benchmarks for BERT Large Question Answering inference for RedisAI and RedisGears</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/howtos/hackernews">How to build a HackerNews Clone using Redis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/howtos/antipatterns/">Redis Anti-Patterns Every Developer Should Avoid</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/howtos/socialnetwork/">Building a Social Network Application using RediSearch</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/howtos/security/">How to Use SSL/TLS With Redis Enterprise</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/howtos/analytics">Building an Analytics dashboard app using Redis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/howtos/popupstore">Building a Popup Store application using Redis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/howtos/herokunodejs">How to build a NodeJS based application on Heroku using Redis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/howtos/herokupython">How to build a Python based application on Heroku using Redis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/howtos/herokujava">How to build a Java based application on Heroku using Redis</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/community/">Get Involved</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/ebooks/8-nosql-data-modeling-patterns">E-books</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">HowTos &amp; Tutorials</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Benchmarks for BERT Large Question Answering inference for RedisAI and RedisGears</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Benchmarks for BERT Large Question Answering inference for RedisAI and RedisGears</h1></header><div class="docAuthors"><hr><div class="authorByline_VoxI"><img class="authorProfileImage_URwT" src="/img/profile_pic_alex_mikhalev.jpg" alt="Profile picture for Alex Mikhalev"><div><div class="authorLabel_a70t">Author:</div><div><a href="https://www.linkedin.com/in/alexmikhalev" target="_blank">Alex Mikhalev</a>, <!-- -->AI/ML Architect at Nationwide Building Society</div></div></div><div class="authorByline_VoxI"><img class="authorProfileImage_URwT" src="/img/profile_pic_will_johnston.jpg" alt="Profile picture for Will Johnston"><div><div class="authorLabel_a70t">Author:</div><div><a href="https://twitter.com/wjohnsto" target="_blank">Will Johnston</a>, <!-- -->Developer Growth Manager at Redis</div></div></div><hr></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">​</a></h2><p>In this article, we will explore the challenges and opportunities associated with deploying <a href="https://huggingface.co/bert-large-uncased-whole-word-masking-finetuned-squad" target="_blank" rel="noopener noreferrer">large BERT Question Answering Transformer</a> models from Hugging Face, using <a href="/howtos/redisgears">RedisGears</a> and <a href="/howtos/redisai/getting-started">RedisAI</a> to perform a lot of the heavy lifting while also leveraging the in-memory datastore Redis.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="why-do-we-need-redisai">Why do we need RedisAI?<a class="hash-link" href="#why-do-we-need-redisai" title="Direct link to heading">​</a></h2><p>In data science workloads:</p><ul><li>You want to load high-performance hardware as close to 100% as possible</li><li>You prefer to re-calculate results</li></ul><p>However, in a client-facing application:</p><ul><li>You want to be able to distribute the load evenly, so it never reaches 100%, and client-facing servers can perform additional functions</li><li>You prefer to cache results of previous calculations and fetch data from the cache as fast as possible to provide a seamless customer experience</li></ul><p>So before we go any further, <strong>why should you read this article?</strong> Here are some numbers for inspiration:</p><p>First:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">python3 transformers_plain_bert_qa.py</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">airborne transmission of respiratory infections is the lack of established methods for the detection of airborne respiratory microorganisms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">10.351818372 seconds</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above script uses a slightly modified transformer from the default pipeline for BERT QA, and running it on the server takes 10 seconds. The server uses the latest 12th Gen Intel(R) Core(TM) i9-12900K, <a href="https://gist.github.com/AlexMikhalev/354ddc3094b0d3b95b11a411ea000a5a" target="_blank" rel="noopener noreferrer">full cpuinfo</a>.</p><p>However:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">time curl -i -H &quot;Content-Type: application/json&quot; -X POST -d &#x27;{&quot;search&quot;:&quot;Who performs viral transmission among adults&quot;}&#x27; http://localhost:8080/qasearch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">real    0m0.747s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">user    0m0.004s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sys 0m0.000s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The scriptscript runs BERT QA inference on <strong>each shard</strong>, which is equal to the number of available CPUs by default, and returns answers under one second.</p><p>Incredible, right? Let&#x27;s dive in!</p><h1>Background</h1><p>BERT Question Answering inference works where the ML model selects an answer from the given text. In other words, BERT QA &quot;thinks&quot; through the following: &quot;What is the answer from the text, assuming the answer to the question exists within the paragraph selected.&quot;</p><p>So it&#x27;s important to select text potentially containing an answer. A typical pattern is to use Wikipedia data to build <a href="https://lilianweng.github.io/posts/2020-10-29-odqa/" target="_blank" rel="noopener noreferrer">Open Domain Question Answering</a>.</p><p>Our QA system is a medical domain-specific question/answering pipeline, hence we need a first pipeline that turns data into a knowledge graph. This NLP pipeline is available at Redis LaunchPad, is fully <a href="https://github.com/applied-knowledge-systems/the-pattern" target="_blank" rel="noopener noreferrer">open source</a>, and is described in <a href="/howtos/nlp">a previous article</a>. Here is a 5 minute <a href="https://www.youtube.com/watch?v=VgJ8DTX5Mt4" target="_blank" rel="noopener noreferrer">video</a> describing it, and below you will find an architectural overview:</p><p><img loading="lazy" alt="featured" src="/assets/images/featured-323f9deb405b9d0f52b467acddc87818.jpg" width="960" height="540" class="img_ev3q"></p><h1>BERT Question Answering pipeline and API</h1><p>In the BERT QA pipeline (or in any other modern NLP inference task), there are two steps:</p><ol><li>Tokenize text - turn text into numbers</li><li>Run the inference - large matrix multiplication</li></ol><p>With Redis, we have the opportunity to pre-compute everything and store it in memory, but how do we do it? Unlike with the summarization ML learning task, the question is not known in advance, so we can&#x27;t pre-compute all possible answers. However, we can pre-tokenize all potential answers (i.e. all paragraphs in the dataset) using RedisGears:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">parse_sentence</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">record</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> redisAI</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> numpy </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">global</span><span class="token plain"> tokenizer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">not</span><span class="token plain"> tokenizer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        tokenizer</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">loadTokeniser</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    hash_tag</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{%s}&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">%</span><span class="token plain"> hashtag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> idx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> value </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">sorted</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">record</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;value&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">items</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> key</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token keyword" style="font-style:italic">lambda</span><span class="token plain"> item</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">item</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        tokens </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> tokenizer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> add_special_tokens</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> max_length</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">511</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> truncation</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> return_tensors</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;np&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        tokens </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tokens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">tokenizer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sep_token_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">astype</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">np</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">int64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        tensor</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">redisAI</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">createTensorFromBlob</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;INT64&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> tokens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> tokens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">tobytes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        key_prefix</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;sentence:&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        sentence_key</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">remove_prefix</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">record</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;key&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">key_prefix</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        token_key </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">f&quot;tokenized:bert:qa:</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string-interpolation interpolation">sentence_key</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">:</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string-interpolation interpolation">idx</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        redisAI</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">setTensorInKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">token_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> tensor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SADD&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">f&#x27;processed_docs_stage3_tokenized</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string-interpolation interpolation">hash_tag</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> token_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>See the <a href="https://github.com/applied-knowledge-systems/the-pattern-api/blob/156633b9934f1243775671ce6c18ff2bf471c0ce/qasearch/tokeniser_gears_redisai.py#L17" target="_blank" rel="noopener noreferrer">full code on GitHub</a>.</p><p>Then for each Redis Cluster shard, we pre-load the BERT QA model by downloading, exporting it into torchscript, then loading it into each shard:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">load_bert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    model_file </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;traced_bert_qa.pt&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">open</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">model_file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;rb&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        model </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">read</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    startup_nodes </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;host&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;127.0.0.1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;port&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;30001&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;host&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;127.0.0.1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;port&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;30002&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;host&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;127.0.0.1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;port&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;30003&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ClusterClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">startup_nodes </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> startup_nodes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    hash_tags </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">execute_command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;RG.PYEXECUTE&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;gb = GB(&#x27;ShardsIDReader&#x27;).map(lambda x:hashtag()).run()&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">hash_tags</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> hash_tag </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> hash_tags</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Loading model bert-qa{%s}&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">%</span><span class="token plain">hash_tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">decode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;utf-8&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        cc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">modelset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;bert-qa{%s}&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">%</span><span class="token plain">hash_tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">decode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;utf-8&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;TORCH&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;CPU&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> model</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">infoget</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;bert-qa{%s}&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">%</span><span class="token plain">hash_tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">decode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;utf-8&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <a href="https://github.com/applied-knowledge-systems/the-pattern-api/blob/156633b9934f1243775671ce6c18ff2bf471c0ce/qasearch/export_load_bert.py" target="_blank" rel="noopener noreferrer">full code is available on GitHub</a>.</p><p>And when a question comes from the user, we tokenize and append the question to the list of potential answers before running the RedisAI model:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    token_key </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">f&quot;tokenized:bert:qa:</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string-interpolation interpolation">sentence_key</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># encode question</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    input_ids_question </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> tokenizer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> add_special_tokens</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> truncation</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> return_tensors</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;np&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    t</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">redisAI</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">getTensorFromKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">token_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    input_ids_context</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">to_np</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">np</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">int64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># merge (append) with potential answer, context - is pre-tokenized paragraph</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    input_ids </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_ids_question</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">input_ids_context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    attention_mask </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token builtin" style="color:rgb(130, 170, 255)">len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_ids</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    input_idss</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">np</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">input_ids</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    num_seg_a</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">input_ids_question</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    num_seg_b</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">input_ids_context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    token_type_ids </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">num_seg_a </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">num_seg_b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># create actual model runner for RedisAI</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    modelRunner </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> redisAI</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">createModelRunner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">f&#x27;bert-qa</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string-interpolation interpolation">hash_tag</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># make sure all types are correct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    input_idss_ts</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">redisAI</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">createTensorFromBlob</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;INT64&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> input_idss</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> input_idss</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">tobytes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    attention_mask_ts</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">redisAI</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">createTensorFromBlob</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;INT64&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> attention_mask</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> attention_mask</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">tobytes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    token_type_ids_ts</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">redisAI</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">createTensorFromBlob</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;INT64&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> token_type_ids</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> token_type_ids</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">tobytes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    redisAI</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">modelRunnerAddInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">modelRunner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;input_ids&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> input_idss_ts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    redisAI</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">modelRunnerAddInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">modelRunner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;attention_mask&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> attention_mask_ts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    redisAI</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">modelRunnerAddInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">modelRunner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;token_type_ids&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> token_type_ids_ts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    redisAI</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">modelRunnerAddOutput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">modelRunner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;answer_start_scores&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    redisAI</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">modelRunnerAddOutput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">modelRunner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;answer_end_scores&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># run RedisAI model runner</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    res </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> redisAI</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">modelRunnerRunAsync</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">modelRunner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    answer_start_scores</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">to_np</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">np</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">float32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    answer_end_scores </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> to_np</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">np</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">float32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    answer_start </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">argmax</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">answer_start_scores</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    answer_end </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">argmax</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">answer_end_scores</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    answer </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> tokenizer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">convert_tokens_to_string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tokenizer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">convert_ids_to_tokens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_ids</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">answer_start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">answer_end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">skip_special_tokens </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Answer &quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token builtin" style="color:rgb(130, 170, 255)">str</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">answer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> answer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Checkout the <a href="https://github.com/applied-knowledge-systems/the-pattern-api/blob/156633b9934f1243775671ce6c18ff2bf471c0ce/qasearch/qa_redisai_keymiss_no_cache_np.py#L34" target="_blank" rel="noopener noreferrer">full code, available on GitHub</a>.</p><p>The process for making a BERT QA API call looks like this:</p><p><img loading="lazy" alt="Architecture Diagram for BERT QA RedisGears and RedisAI" src="/assets/images/diagrams_02-6878694a2bf465961ee30761a8190377.png" width="3840" height="2160" class="img_ev3q"></p><p>Here I use two cool features of RedisGears: capturing events on key miss and using async/await to run RedisAI on each shard without locking the primary thread - so that Redis Cluster can continue to serve other customers. For benchmarks, caching responses from RedisAI is <a href="https://github.com/applied-knowledge-systems/the-pattern-api/blob/156633b9934f1243775671ce6c18ff2bf471c0ce/qasearch/qa_redisai_keymiss_no_cache_np.py#L29" target="_blank" rel="noopener noreferrer">disabled</a>. If you are getting response times in nanoseconds on the second call rather then milliseconds, check to make sure the line linked above is commented out.</p><h1>Running the Benchmark</h1><p>Pre-requisites for running the benchmark:</p><p>Assuming you are running Debian or Ubuntu and have Docker and docker-compose installed (or can create a virtual environment via conda), run the following commands:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone --recurse-submodules https://github.com/applied-knowledge-systems/the-pattern.git</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd the-pattern</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">./bootstrap_benchmark.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above commands should end with a curl call to the qasearch API, since Redis caching is disabled for the benchmark.</p><p>Next, invoke curl like this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">time curl -i -H &quot;Content-Type: application/json&quot; -X POST -d &#x27;{&quot;search&quot;:&quot;Who performs viral transmission among adults&quot;}&#x27; http://localhost:8080/qasearch</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Expect the following output, or something similar based on your runtime environment:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">HTTP/1.1 200 OK</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Server: nginx/1.18.0 (Ubuntu)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Date: Sun, 29 May 2022 12:05:39 GMT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Content-Length: 2120</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Connection: keep-alive</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{&quot;links&quot;:[{&quot;created_at&quot;:&quot;2002&quot;,&quot;rank&quot;:13,&quot;source&quot;:&quot;C0001486&quot;,&quot;target&quot;:&quot;C0152083&quot;}],&quot;results&quot;:[{&quot;answer&quot;:&quot;adenovirus&quot;,&quot;sentence&quot;:&quot;The medium of 40 T150 flasks of adenovirus transducer dec CAR CHO cells yielded 0 5 1 my of purified msCEACAM1a 1 4 protein&quot;,&quot;sentencekey&quot;:&quot;sentence:PMC125375.xml:{mG}:202&quot;,&quot;title&quot;:&quot;Crystal structure of murine sCEACAM1a[1,4]: a coronavirus receptor in the CEA family&quot;}] OUTPUT_REDUCTED}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>I modified the output of the API for the benchmark to return results from all shards - even if the answer is empty. In the run above five shards return answers. The overall API call response takes less than one second with all additional hops to search in RedisGraph!</p><p><img loading="lazy" alt="Architecture Diagram for BERT QA API call" src="/assets/images/diagrams_01-f59ef98d0f8ce8e2eb2fe8ccb151eca6.png" width="3750" height="1752" class="img_ev3q"></p><h1>Deep Dive into the Benchmark</h1><p>Let&#x27;s dig deeper into what&#x27;s happening under the hood:</p><p>You should have a sentence key with shard id, which you get by looking at the &quot;Cache key&quot; from <code>docker logs -f rgcluster</code>. In my setup the cache key is, &quot;bertqa{6fd}<!-- -->_<!-- -->PMC169038.xml:{6fd}:33_Who performs viral transmission among adults&quot;. If you think it looks like a function call it&#x27;s because it is a function call. It is triggered if the key isn&#x27;t present in the Redis Cluster, which for the benchmark will be every time since if you remember we disabled caching the output.</p><p>One more thing to figure out from the logs is the port of the shard corresponding to the hashtag, also known as the <code>shard id</code>. It is the text found in betweeen the curly brackets – looks like <code>{6fd}</code> above. The same will be in the output for the <code>export_load</code> script. In my case the cache key was found in &quot;30012.log&quot;, so my port is 30012.</p><p>Next I run the following command:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">redis-cli -c -p 300012 -h 127.0.0.1 get &quot;bertqa{6fd}_PMC169038.xml:{6fd}:33_Who performs viral transmission among adults&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and then run the benchmark:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">redis-benchmark -p 30012 -h 127.0.0.1 -n 10 get &quot;bertqa{6fd}_PMC169038.xml:{6fd}:33_Who performs viral transmission among adults&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">====== get bertqa{6fd}_PMC169038.xml:{6fd}:33_Who performs viral transmission among adults ======</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  10 requests completed in 0.04 seconds</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  50 parallel clients</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  3 bytes payload</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  keep alive: 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">10.00% &lt;= 41 milliseconds</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">100.00% &lt;= 41 milliseconds</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">238.10 requests per second</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you are wondering, <code>-n</code> = number of times. In this case we run the benchmark 10 times. You can also add:</p><p>– <code>csv</code> if you want to output in CSV format</p><p>– <code>precision 3</code> if you want more decimals in the ms</p><p>More information about the benchmarking tool can be found on the <a href="https://redis.io/topics/benchmarks" target="_blank" rel="noopener noreferrer">redis.io Benchmarks page</a>.</p><p>if you don&#x27;t have redis-utils installed locally, you can use Docker as follows:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">exec</span><span class="token plain"> -it rgcluster /bin/bash</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">redis-benchmark -p </span><span class="token number" style="color:rgb(247, 140, 108)">30012</span><span class="token plain"> -h </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1 -n </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"> get </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;bertqa{6fd}_PMC169038.xml:{6fd}:33_Who performs viral transmission among adults&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> get bertqa</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">6fd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">_PMC169038.xml:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">6fd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">:33_Who performs viral transmission among adults </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"> requests completed </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.75</span><span class="token plain"> seconds</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token number" style="color:rgb(247, 140, 108)">50</span><span class="token plain"> parallel clients</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token number" style="color:rgb(247, 140, 108)">99</span><span class="token plain"> bytes payload</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  keep alive: </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">host</span><span class="token plain"> configuration </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;save&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">host</span><span class="token plain"> configuration </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;appendonly&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> no</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  multi-thread: no</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Latency by percentile distribution:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">0.000</span><span class="token plain">% </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">243.711</span><span class="token plain"> milliseconds </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cumulative count </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">50.000</span><span class="token plain">% </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">987.135</span><span class="token plain"> milliseconds </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cumulative count </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">75.000</span><span class="token plain">% </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1577.983</span><span class="token plain"> milliseconds </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cumulative count </span><span class="token number" style="color:rgb(247, 140, 108)">8</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">87.500</span><span class="token plain">% </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1662.975</span><span class="token plain"> milliseconds </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cumulative count </span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">93.750</span><span class="token plain">% </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1744.895</span><span class="token plain"> milliseconds </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cumulative count </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">100.000</span><span class="token plain">% </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1744.895</span><span class="token plain"> milliseconds </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cumulative count </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Cumulative distribution of latencies:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">0.000</span><span class="token plain">% </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.103</span><span class="token plain"> milliseconds </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cumulative count </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">10.000</span><span class="token plain">% </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">244.223</span><span class="token plain"> milliseconds </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cumulative count </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">20.000</span><span class="token plain">% </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">409.343</span><span class="token plain"> milliseconds </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cumulative count </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">30.000</span><span class="token plain">% </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">575.487</span><span class="token plain"> milliseconds </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cumulative count </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">40.000</span><span class="token plain">% </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">821.247</span><span class="token plain"> milliseconds </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cumulative count </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">50.000</span><span class="token plain">% </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">987.135</span><span class="token plain"> milliseconds </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cumulative count </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">60.000</span><span class="token plain">% </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1157.119</span><span class="token plain"> milliseconds </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cumulative count </span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">70.000</span><span class="token plain">% </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1497.087</span><span class="token plain"> milliseconds </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cumulative count </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">80.000</span><span class="token plain">% </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1577.983</span><span class="token plain"> milliseconds </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cumulative count </span><span class="token number" style="color:rgb(247, 140, 108)">8</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">90.000</span><span class="token plain">% </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1662.975</span><span class="token plain"> milliseconds </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cumulative count </span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">100.000</span><span class="token plain">% </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1744.895</span><span class="token plain"> milliseconds </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cumulative count </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Summary:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  throughput summary: </span><span class="token number" style="color:rgb(247, 140, 108)">5.73</span><span class="token plain"> requests per second</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  latency summary </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">msec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          avg       min       p50       p95       p99       max</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token number" style="color:rgb(247, 140, 108)">1067.296</span><span class="token plain">   </span><span class="token number" style="color:rgb(247, 140, 108)">243.584</span><span class="token plain">   </span><span class="token number" style="color:rgb(247, 140, 108)">987.135</span><span class="token plain">  </span><span class="token number" style="color:rgb(247, 140, 108)">1744.895</span><span class="token plain">  </span><span class="token number" style="color:rgb(247, 140, 108)">1744.895</span><span class="token plain">  </span><span class="token number" style="color:rgb(247, 140, 108)">1744.895</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The platform only has 20 articles and 8 Redis nodes (4 masters + 4 slaves), so relevance would be wrong and it doesn&#x27;t need a lot of memory.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="aiinfo">AI.INFO<a class="hash-link" href="#aiinfo" title="Direct link to heading">​</a></h2><p>Now let&#x27;s check how long our RedisAI model runs on the <code>{6fd}</code> shard:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">127.0.0.1:30012&gt; AI.INFO bert-qa{6fd}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 1) &quot;key&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 2) &quot;bert-qa{6fd}&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 3) &quot;type&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 4) &quot;MODEL&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 5) &quot;backend&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 6) &quot;TORCH&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 7) &quot;device&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 8) &quot;CPU&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 9) &quot;tag&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">10) &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">11) &quot;duration&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">12) (integer) 8928136</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13) &quot;samples&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">14) (integer) 58</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">15) &quot;calls&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">16) (integer) 58</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">17) &quot;errors&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">18) (integer) 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>bert-qa{6fd}</code> is the key of the actual (very large) model saved. The <code>AI.INFO</code> command gives us a cumulative duration of 8928136 microseconds and 58 calls, which is approximately 153 milliseconds per call.</p><p>Let&#x27;s double-check to make sure that&#x27;s right by resetting the stats and then re-runnning the benchmark.</p><p>First, reset the stats:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">127.0.0.1:30012&gt; AI.INFO bert-qa{6fd} RESETSTAT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">127.0.0.1:30012&gt; AI.INFO bert-qa{6fd}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 1) &quot;key&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 2) &quot;bert-qa{6fd}&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 3) &quot;type&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 4) &quot;MODEL&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 5) &quot;backend&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 6) &quot;TORCH&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 7) &quot;device&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 8) &quot;CPU&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 9) &quot;tag&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">10) &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">11) &quot;duration&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">12) (integer) 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13) &quot;samples&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">14) (integer) 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">15) &quot;calls&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">16) (integer) 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">17) &quot;errors&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">18) (integer) 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then, re-run the benchmark:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">redis-benchmark -p 30012 -h 127.0.0.1 -n 10 get &quot;bertqa{6fd}_PMC169038.xml:{6fd}:33_Who performs viral transmission among adults&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">====== get bertqa{6fd}_PMC169038.xml:{6fd}:33_Who performs viral transmission among adults ======</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  10 requests completed in 1.78 seconds</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  50 parallel clients</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  99 bytes payload</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  keep alive: 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  host configuration &quot;save&quot;:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  host configuration &quot;appendonly&quot;: no</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  multi-thread: no</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Latency by percentile distribution:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0.000% &lt;= 188.927 milliseconds (cumulative count 1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">50.000% &lt;= 995.839 milliseconds (cumulative count 5)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">75.000% &lt;= 1606.655 milliseconds (cumulative count 8)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">87.500% &lt;= 1692.671 milliseconds (cumulative count 9)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">93.750% &lt;= 1779.711 milliseconds (cumulative count 10)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">100.000% &lt;= 1779.711 milliseconds (cumulative count 10)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Cumulative distribution of latencies:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0.000% &lt;= 0.103 milliseconds (cumulative count 0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">10.000% &lt;= 189.183 milliseconds (cumulative count 1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">20.000% &lt;= 392.191 milliseconds (cumulative count 2)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">30.000% &lt;= 540.159 milliseconds (cumulative count 3)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">40.000% &lt;= 896.511 milliseconds (cumulative count 4)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">50.000% &lt;= 996.351 milliseconds (cumulative count 5)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">60.000% &lt;= 1260.543 milliseconds (cumulative count 6)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">70.000% &lt;= 1456.127 milliseconds (cumulative count 7)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">80.000% &lt;= 1606.655 milliseconds (cumulative count 8)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">90.000% &lt;= 1692.671 milliseconds (cumulative count 9)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">100.000% &lt;= 1779.711 milliseconds (cumulative count 10)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Summary:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  throughput summary: 5.62 requests per second</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  latency summary (msec):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          avg       min       p50       p95       p99       max</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     1080.454   188.800   995.839  1779.711  1779.711  1779.711</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now check the stats again:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">AI.INFO bert-qa{6fd}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 1) &quot;key&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 2) &quot;bert-qa{6fd}&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 3) &quot;type&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 4) &quot;MODEL&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 5) &quot;backend&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 6) &quot;TORCH&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 7) &quot;device&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 8) &quot;CPU&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 9) &quot;tag&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">10) &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">11) &quot;duration&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">12) (integer) 1767749</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13) &quot;samples&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">14) (integer) 20</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">15) &quot;calls&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">16) (integer) 20</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">17) &quot;errors&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">18) (integer) 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now we get 88387.45 microseconds per call, which is pretty fast! Also, considering we started with 10 seconds per call, I think the benefits of using RedisAI in combination with RedisGears are pretty obvious. However, the trade-off is high memory usage.</p><p>There are many ways to optimize this deployment. For example, you can add a FP16 quantization and ONNX runtime. If you would like to try that, <a href="https://github.com/applied-knowledge-systems/the-pattern-api/blob/7bcf021e537dc8d453036730f0a993dd52e1781f/qasearch/export_load_bert.py" target="_blank" rel="noopener noreferrer">this script</a> will be a good starting point.</p><h1>Using Grafana to monitor RedisGears throughput, CPU, and Memory usage</h1><p>Thanks to the contribution of <a href="https://volkovlabs.com/from-a-basic-redistimeseries-data-source-to-2-million-downloads-in-grafana-marketplace-9921ed9ac5a" target="_blank" rel="noopener noreferrer">Mikhail Volkov</a>, we can now observe RedisGears and RedisGraph throughput and memory consumption using Grafana. When you cloned repository it started Graphana Docker, which has pre-build templates to monitor RedisCluster, including RedisGears and RedisAI, and Graph - which is Redis with RedisGraph. &quot;The Pattern&quot; dashboard provides an overview, with all the key benchmark metrics you care about:</p><p><img loading="lazy" alt="Grafana for RedisGraph" src="/assets/images/graphana_redis_graph-dd5e293dcc8fe4f6e55e2ff7b98056da.png" width="1420" height="575" class="img_ev3q"></p><p><img loading="lazy" alt="Grafana for RedisCluster" src="/assets/images/graphana_cluster_overview-ec7918d8d5354c159a7d40a977c5e0c4.png" width="1920" height="978" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/community">community</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/redis-developer/redis-developer/edit/master/docs/howtos/bert-qa-benchmarking/index-bert-qa-benchmarking-with-redisai-and-redisgears.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-11-10T17:16:41.000Z">Nov 10, 2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/howtos/nlp"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Building a Pipeline for Natural Language Processing using RedisGears</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/howtos/hackernews"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">How to build a HackerNews Clone using Redis</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#why-do-we-need-redisai" class="table-of-contents__link toc-highlight">Why do we need RedisAI?</a></li><li><a href="#aiinfo" class="table-of-contents__link toc-highlight">AI.INFO</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><svg width="785" height="158" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="shape"><defs><path d="M786.344 392.459c-41.822 22.164-258.313 110.84-305.056 135.477-46.742 24.637-72.163 23.812-108.246 6.57-36.082-17.24-267.334-111.664-309.156-131.377-41.822-19.713-42.642-33.657-1.64-49.271C103.25 338.265 332.86 247.94 381.243 229.875c48.383-18.065 65.604-18.065 106.605-2.473 41.003 15.614 256.674 100.996 297.676 115.785 41.002 14.791 42.642 27.912.82 49.273v-.001z" id="a"></path><mask id="b" maskContentUnits="userSpaceOnUse" maskUnits="objectBoundingBox" x="0" y="0" width="785" height="331" fill="#fff"><use xlink:href="#a"></use></mask></defs><use mask="url(#b)" xlink:href="#a" transform="translate(-32 -216)" stroke="#465282" stroke-width="4" fill="none" fill-rule="evenodd" stroke-dasharray="3.637"></use></svg><img src="/img/code-2.png" class="code" alt=""><div class="row"><div class="col col--3"><div class="footer__logo-ctr"><span class="footer__logo-tagline">Made with &lt;/&gt; by</span><a href="https://redis.com/" target="_blank" rel="noopener" class="footerLogoLink_fGS1"><img loading="lazy" class="footer__logo" alt="Redis logo" src="/img/redis_logo_red_white_rgb.svg"></a></div></div><div class="col col--9"><div class="row footer__links"><div class="col col--4 footer__col"><h4 class="footer__title">Get Started</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/create/rediscloud">Create Database</a></li><li class="footer__item"><a class="footer__link-item" href="/develop/">Develop</a></li><li class="footer__item"><a class="footer__link-item" href="/explore/redisinsight/">Explore your data</a></li><li class="footer__item"><a href="https://redis.com/redis-best-practices/introduction/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Best Practices</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/create/redis-stack/">Redis Stack</a></li></ul></div><div class="col col--4 footer__col"><h4 class="footer__title">Resources</h4><ul class="footer__items"><li class="footer__item"><a href="https://redis.com/community/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community</a></li><li class="footer__item"><a href="https://university.redis.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Redis University</a></li><li class="footer__item"><a href="https://redis.io/commands" target="_blank" rel="noopener noreferrer" class="footer__link-item">Redis Commands</a></li><li class="footer__item"><a class="footer__link-item" href="/howtos">How-tos &amp; tutorials</a></li><li class="footer__item"><a href="https://stackoverflow.com/search?q=redis" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li></ul></div></div></div></div><div class="footer__copyright">Copyright: © 2023 Redis. All rights reserved. Redis and the cube logo are registered trademarks of Redis Ltd.</div></div></footer></div>
<script src="/assets/js/runtime~main.80864dfb.js"></script>
<script src="/assets/js/main.853f37c5.js"></script>
</body>
</html>